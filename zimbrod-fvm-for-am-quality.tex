\documentclass[conference,final]{IEEEtran}

\makeatletter
\def\ps@IEEEtitlepagestyle{%
  \def\@oddfoot{\mycopyrightnotice}%
  \def\@evenfoot{}%
}
\def\mycopyrightnotice{%
  {\footnotesize XXX-X-XXXX-XXXX-X/XX/\$XX.00~\copyright~20XX IEEE\hfill}% <--- Change here
  \gdef\mycopyrightnotice{}
}


\usepackage{blindtext}
\usepackage{eso-pic}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\interdisplaylinepenalty=2500
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{url}
\usepackage{orcidlink}
\usepackage{siunitx}
\usepackage{textcomp}
\usepackage{booktabs}
\usepackage{xcolor}
\usepackage{hyperref}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
    
\usepackage{eso-pic}
\newcommand\AtPageUpperMyright[1]{\AtPageUpperLeft{%
 \put(\LenToUnit{0.17\paperwidth},\LenToUnit{-2cm}){%
     \parbox{0.9\textwidth}{\raggedleft\fontsize{8}{11}\selectfont #1}}%
 }}%
\newcommand{\conf}[1]{%
\AddToShipoutPictureBG*{%
\AtPageUpperMyright{#1}
}
}    
    
    
\begin{document}
\title{\vspace*{1cm} %Efficient simulation of surface tension effects in using an h-adaptive Finite Volume Method \\
An efficient, high-order, adaptive Finite Volume solver for modelling fluid behavior in advanced manufacturing processes\\
}

\author{\IEEEauthorblockN{Patrick Zimbrod\orcidlink{0000-0003-3108-3171}}
\IEEEauthorblockA{\textit{Digital Manufacturing} \\
\textit{University of Augsburg}\\
Augsburg, Germany\\
patrick.zimbrod@uni-a.de}
\and
\IEEEauthorblockN{Johannes Schilp}
\IEEEauthorblockA{\textit{Digital Manufacturing} \\
\textit{University of Augsburg}\\
Augsburg, Germany\\
johannes.schilp@uni-a.de}
}

\maketitle
\conf{\textit{  Proc. of the International Conference on Electrical, Computer, Communications and Mechatronics Engineering  (ICECCME) \\ 
16-18 November 2022, Maldives}}
\begin{abstract}
We present a free and open source implementation of the Finite Volume Method that captures thermal and solute-driven free-surface flows, more commonly known as Marangoni flows. This type of physics commonly appears within additive manufacturing and is known to be challenging to resolve. The application is capable of performing adaptive mesh refinement coupled with high order WENO schemes in order to substantially save computational cost in multiphase flows where accurate tracking of the phase boundaries is crucial. By accurately simulating the temporal evolution of melt pools, unique insight into the physics of melt pool formation is possible that is otherwise hard to gain experimentally. We demonstrate our work by a simple two-dimensional benchmark case and outline possible applications with a mesoscopic model of Laser Powder Bed Fusion additive manufacturing.
\end{abstract}

\begin{IEEEkeywords}
finite volume method, adaptive refinement, marangoni flow, open source software
\end{IEEEkeywords}

\section{Introduction}

Accurate modelling of complex physics has received considerable attention within the last two decades.
This can mostly be attributed to the fact that an increased understanding of the phenomena relevant for manufacturing directly leads to more finely tuned or even new processes that tend to increase output quality.

Two such examples that shall serve as a guideline for this work are microfluidic applications and additive manufacturing of metals.
Both groups of processes are characterized by complex flow phenomena that involve several physical phenomena on a microscopic scale \cite{sackmannPresentFutureRole,debroyAdditiveManufacturingMetallic2018}. The fact that those effects tend to have fast dynamics further complicates the analysis \cite{khairallahControllingInterdependentMesonanosecond2020}. This leads to an increased amount of empirical effort necessary to capture and quantify the flow patterns involved.

Hence, simulation has gained considerable traction as an alternative to extensive experimental research. Within computational simulation frameworks, the involved physics can be precisely monitored, even to a nanoseconds scale, which would oftentimes be probhibitively expensive. At the same time, a considerable drawback of this approach is the additional amount of work that has to be put into the mathematical modelling of the involved physics. Especially within fluid dynamics, gaining a stable as well as accurate solution can oftentimes be challenging, as the resulting set of partial differential equations can have a small stability region in the temporal domain.

Therefore in this work, we propose and demonstrate a performant, free and open source software framework based on the Finite Volume method that is able to capture complex, non-isothermal surface flows. We discuss the necessary mathematical modelling and briefly address

\section{Theory}

The theory of the proposed implementation relies on the Continuum Surface Stress Method initially presented by Lafaurie et al., extending the works on modelling surface tension with the Volume of Fluid Method as described by Brackbill et al. \cite{lafaurieModellingMergingFragmentation1994,brackbillContinuumMethodModeling1992}.
To describe the necessary linear algebra, we will use the index notation of tensors in a cartesian coordinate system alongside with the Einstein summation convention where the sum over matching indices is implied. First, the capillary stress tensor is introduced:

\begin{equation}
    T_{ij} = - \sigma \delta_s (\delta_{ij} - n_i n_j)
\end{equation}

Where $\sigma$ is the generally non constant coefficient of surface tension. $\delta_s$ is the interface delta function that serves as an indicator function of where the phase boundaries are located. $\delta_{ij}$ is the Kronecker Delta function and $n_i$ is the interface unit normal vector. The local coordinate system of the interface needs to be an orthogonal system in order to separate the purely geometry based capillary force and the tangential Marangoni forces.
The resulting force accounting for all surface tension effects can now be expressed as the divergence of the capillary stress tensor, yielding:

\begin{equation}
    \frac{\partial T_{ij}}{\partial x_j} = \frac{\partial \sigma}{\partial x_j} [\delta_s(\delta_{ij} - n_i n_j)] + \frac{\partial \delta_s}{\partial x_j} [\sigma (\delta_{ij} - n_i n_j)] + \sigma \delta_s \frac{\partial}{\partial x_j} (\delta_{ij} - n_i n_j) \label{eq:stress-tensor}
\end{equation}

One can show that Eq. \ref{eq:stress-tensor} can be re-arranged using some tensor algebra and geometric identities into a much shorter and more useful form. The derivation is given in more detail by Lafaurie et al. \cite{lafaurieModellingMergingFragmentation1994}. By performing those rearrangements, we can recover a form that separates the normal from the tangential components of the divergence vector:

\begin{equation}
\label{eq:divergence-capillarystress}
    \frac{\partial T_{ij}}{\partial x_j} = \frac{\partial \sigma}{\partial x_i} [\delta_s(\delta_{ij} - n_i n_j)] - \sigma \kappa n_i \delta_s 
\end{equation}

Here, the interface curvature $\kappa$ is introduced. The second term of the right hand side corresponds to the normal capillary force directed in the normal direction of the interface, effecting a contractional movement of the interface. The first term resembles the marangoni-type forces present. By taking the derivative of the surface tension coefficient, this term does not vanish iff there are gradients present at the interface. This is normally the case when there are multiple species involved or temperature gradients present \cite{j.straubThermokapillareGrenzflachenkonvektionGasblasen1990}. Note that we then simply evaluate the ordinary form of surface tension without any additional physics present. However, as the surface tension coefficient is otherwise not a direct local variable, one must further differentiate the term:

\begin{equation}
    \frac{\partial \sigma(c,T)}{\partial x_j} = \frac{\partial \sigma(c,T)}{\partial T} \frac{\partial T}{\partial x_j} + \frac{\partial \sigma(c,T)}{\partial c} \frac{\partial c}{\partial x_j}
    \label{eq:sigmadiff}
\end{equation}

Additionally, the delta function $\delta_s$ needs to be discretized in a suitable manner in order to capture the physics within the Finite Volume framework. This can be done using the Volume of Fluid Method by taking the gradient of the phase volume fraction $\alpha$ \cite{gueyffierVolumeofFluidInterfaceTracking1999,hirtVolumeFluidVOF1981}:

\begin{equation}
    \delta_s = \left\lvert \frac{\partial \alpha}{\partial x_i} \right\rvert
\end{equation}

The interface unit normal vector $n_i$ can be computed in a similar manner by using the previously computed interface function:

\begin{equation}
    n_i = \frac{1}{\delta_s} \frac{\partial \alpha}{\partial x_i}
\end{equation}

To perform the finite volume simulations, the Open Source C++ Library OpenFOAM is used in Version 2106. In order to accommodate the extended surface stress formulation, some of the existing solver capabilities need to be modified. The changes necessary are elaborated on in more detail in the following chapter.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Results}

\subsection{Implementation}

This foundation is modified and implemented based on the open source library OpenFOAM based on version 2106, which is a popular software library that implements the Finite Volume Method \cite{jasakOpenFOAMLibraryComplex2007}. The modifications rely on the works of Gueyffier et al. in order to account for the additional Marangoni stresses \cite{gueyffierVolumeofFluidInterfaceTracking1999}.

The proposed code computes the divergence of the capillary stress tensor for finite volume cell centers. However, to handle source terms within the PIMPLE loop, it is necessary to also supply the surface tension force as a scalar interpolated to the cell face. Therefore, an additional method is implemented that computes the $L_2$ norm of the surface tension force vector and interpolates the scalar value via finite differencing.

For powder bed fusion applications where large spacial temperature gradients in the order of \SI[per-mode=fraction]{1e7}{\kelvin \per \metre} can be present \cite{hooperMeltPoolTemperature2018}, it is advisable to use a second order accurate and stable discretisation scheme for the temperature flux, such as the already within OpenFOAM implemented TVD schemes minmod, superBee or vanLeer \cite{roeCharacteristicBasedSchemesEuler1986,vanleerUltimateConservativeDifference1974}.

A very useful property of this approach is that not only thermally driven surface tension effects can be incorporated, but also gradients arising from any kind of inhomogeneity. This means that among others solute-driven effects can also be modelled. This scenario is common in manufacturing processes involving mixing of multiple solvents. Within the context of additive manufacturing, in-situ alloying is a scenario where such effects are not negligible \cite{katz-demyanetzInsituAlloyingNovel2020}.

To account for thermal and solute-driven effects simultaneously, we need to incorporate the temperature dependence of the surface tension as well as interfacial tension between the alloying elements in the liquid state. This allows us to capture not only flow patterns on the liquid-gas interface, but also between liquid interfaces of dissimilar species. We may find accurate values for temperature dependent surface tension in the literature. However, determining interfacial tension poses a non-trivial problem that has been discussed in the literature \cite{marmurCorrelatingInterfacialTensions2010}.

Naturally, the occurence of interfaces between dissimilar materials is not unique to the setting of in-situ alloying. Mixing of different species is an effect that is oftentimes observed in microfluidic applications as well.

In a pursuit to keep model evaluation simple and not rely on Molecular Dynamics calculations, we use the following, relatively simple approximation for interfacial tension given by Girifalco and Good \cite{girifalcoTheoryEstimationSurface1957}:

\begin{equation}
    \sigma_{1,2} = \sigma_1 + \sigma_1 + 2C (\sigma_1 \sigma_2)^{1/2}
\end{equation}

Here, $\sigma_{1,2}$ denotes the interfacial tension, $\sigma_1$ and $\sigma_2$ are the surface tensions of the involved species and $C$ is a constant which we assume to be unity as a reasonable approximation \cite{marmurCorrelatingInterfacialTensions2010}.

In order to approximate the differential terms in the governing equations efficiently, we use high order weighted essentially non-oscillatory (WENO) schemes that have been developed separately for OpenFOAM by Gärtner et al. \cite{gartnerEfficientWENOLibrary2020,martinImplementationValidationSemiImplicit2018}.

\subsection{Numerical experiments}

First, we examine a well-known setup proposed by Ma et al. that models the flow around a stationary bubble subject to a temperature gradient \cite{maDirectNumericalSimulation2011}. We aim to accurately predict the velocity field that arises due to marangoni convection at the interface.

We then proceed to investigate the mesoscopic nanosecond dynamics during selective laser melting of steel, a common problem within additive manufacturing. Here, we show that our implementation is able to handle geometrically and physically complex simulations in 3D.


\subsection{Marangoni Flow around a droplet}

We now investigate a simple, two-dimensional benchmark case that illustrates the ability to capture Marangoni effects for the present work.

An overview of the material parameters is given in table \ref{tab:droplet-parameters}.

\begin{table}[!t]
\renewcommand{\arraystretch}{1.3}
\caption{Material properties of the oscillating droplet case. The indices indicate that corresponding phase.}
\label{tab:droplet-parameters}
\centering
\begin{tabular}{ll}
\toprule
Quantity & Value [Unit]\\
\midrule
Density $\rho_{1}$ & \SI{250}{\kilo\gram \per \metre\cubed} \\
Density $\rho_{2}$ &  $2 \rho_{1}$ \\
Heat capacity $c_{p,1}$ & \SI{5e-5}{\joule \per \kilo\gram \per \kelvin} \\
Heat capacity $c_{p,2}$ & $2 c_{p,1}$ \\
Viscosity $\mu_{1}$ & \SI{0.012}{\kilo\gram \per \metre \per \second} \\
Viscosity $\mu_{2}$ & $2 \mu_{1}$ \\ 
Thermal conductivity $\lambda_{1}$ & \SI{1.2e-6}{\watt \per \metre \per \kelvin} \\
Thermal conductivity $\lambda_{2}$ & $2 \lambda_{1}$ \\
Surface tension coefficient $\sigma$ & \SI{0.1}{\newton \per \metre} \\
Marangoni coefficient $\sigma_{T}$ & \SI{0.02}{\newton \per \metre \per \kelvin} \\

\bottomrule
\end{tabular}
\end{table}

We initialize the droplet in the center of a rectangular domain of length $4a \times 4a$ where $a = \SI{1.44e-3}{\metre}$ with a radius of $a$. The droplet is subject to a temperature gradient of \SI{200}{\kelvin \per \metre} where the bottom temperature is fixed to \SI{290}{\kelvin}.

We discretize the domain using a coarse grid of 64 x 64 quadrilaterals. The spatial discretization of the divergence is done using a mixture of first order bounded Gaussian schemes and third order WENO schemes.
We impose no-slip boundary conditions at the walls as well as Neumann type boundaries for the temperature at the left and right walls. The temperature gradient is enforced during the entire simulation using Dirichlet boundaries at the bottom and top. We simulate the evolution of the involved fields up to $t = \SI{0.12}{\second}$.

The remainder of the involved numerics and parameters, as well as all boundary conditions can be accessed via the online repository given in section \ref{sec:data}.

The resulting fields at the final time step $t = \SI{0.12}{\second}$ is shown in figure \ref{fig:2d-benchmark}. We can clearly observe the field of vortices that forms around the bubble, initiated from varying pressures along the interface. This is due to the Marangoni effect, resulting in an uneven pressure distribution in the domain. Following equation \ref{eq:divergence-capillarystress}, the first term involving the gradient of the surfact tension coefficient - i.e. the marangoni coefficient times the gradient of the temperature field - does not vanish here and hence induces a non homogeneous pressure contribution.

\begin{figure}[!tbp]
  \centering
  \includegraphics[width=\linewidth]{Figs/2D_Benchmark.eps}
  \caption{Flow field around the droplet at final time $t = \SI{0.12}{\second}$. The resulting velocity vector field (arrows) and temperature field are shown on the left slice of the domain. The right side shows the phase fraction of the droplet as well as the spatial discretisation.}
  \label{fig:2d-benchmark}
\end{figure}

Despite the comparatively low mesh resolution, the phase boundary is conserved reasonably well after solving for 6000 time steps. A comparison of the sharp interface between the two phases at the beginning and end of the simulation is given in figure \ref{fig:alpha-comparison}. During the solution process, only minimal numerical diffusion of the interface occurs, indicated by the slightly tapered off edges of the rectangular profile at end time. In addition, we don't observe any oscillatory behaviour in the fields which is essential for obtaining a stable solution.

\begin{figure}[!tbp]
  \centering
  \includegraphics[width=\linewidth]{Figs/alpha_comparison.eps}
  \caption{Phase fraction profiles of the droplet at beginning and end of the investigated temporal domain. This cross-section represents a diagonal slice from the left top to the right bottom of the grid shown in figure \ref{fig:2d-benchmark}.}
  \label{fig:alpha-comparison}
\end{figure}

\subsection{Powderbed-scale physics during selective laser melting}

We now turn to a more complex and relevant simulation setup that appears regularly in additive manufacturing. We aim to investigate the melting, solidification and evaporation behavior of molten metal during the Laser Powder Bed Fusion Process (PBF-LB/M).

This case shall serve as a showcase of a physically complex problem that involves phase changes, simultaneous handling of solid, liquid and gaseous phases (and hence strong pressure gradients) as well as spatially and temporally localized heat transfer.

The computational domain with the initial conditions for the phase fractions is shown in figure \ref{fig:lpbf-initial}. We create the packing of the metallic powder particles using a rain drop model implemented in the open source Discrete Element Method software Yade \cite{vaclavsmilauerYadeDocumentation2021}.

\begin{figure}[!tbp]
  \centering
  \includegraphics[width=\linewidth]{Figs/powderbed.png}
  \caption{Composition of the computational domain at the initial time step. Solidified build platform (red), discretised powder bed in solid state (green) and gaseous argon atmosphere (blue).}
  \label{fig:lpbf-initial}
\end{figure}


The physical parameters of the PBF-LB/M model are given in table \ref{tab:lpbf-parameters}. The numerical parameters of the model are given in the case files referenced in section \ref{sec:data}.

\begin{table}[!tbp]
\renewcommand{\arraystretch}{1.3}
\caption{Simulation properties of the Laser Powder Bed Fusion test case. The subscripts l, s and g signify the liquid, solid and gaseous phases involved in the model. \cite{valenciaThermophysicalProperties2008,brooksSurfaceTensionSteels2005}}
\label{tab:lpbf-parameters}
\centering
\begin{tabular}{ll}
\toprule
Symbol & Value [Unit]\\
\midrule

  Laser Power & \SI{300}{\watt} \\
  Laser scan speed & \SI{0.9}{\metre \per \second} \\
  Density $\rho_{s}$ & \SI{7950}{\kilo\gram \per \metre\cubed} \\
  Heat capacity $c_{p,s}$ & \SI{412}{\joule \per \kilo\gram \per \kelvin} \\
  Thermal conductivity $\lambda_{s}$ & \SI{1.2e-6}{\watt \per \metre \per \kelvin} \\
  Enthalpy of fusion $H_{f}$ & \SI{2.6e5}{\joule \per \kilo\gram} \\
  Density $\rho_{l}$ & \SI{6881}{\kilo\gram \per \metre\cubed} \\
  Heat capacity $c_{p,l}$ & \SI{790}{\joule \per \kilo\gram \per \kelvin} \\
  Viscosity $\mu_{l}$ & \SI{5.85e-3}{\kilo\gram \per \metre \per \second\squared} \\
  Thermal conductivity $\lambda_{l}$ & \SI{6.6}{\watt \per \metre \per \kelvin} \\
  Heat capacity $c_{p,g}$ & \SI{1900}{\joule \per \kilo\gram \per \kelvin} \\
  Viscosity $\mu_{g}$ & \SI{1.8e-5}{\kilo\gram \per \metre \per \second\squared} \\
  Thermal conductivity $\lambda_{g}$ & \SI{6.6}{\watt \per \metre \per \kelvin} \\
Surface tension coefficient $\sigma$ & \SI{1.908}{\newton \per \metre} \\
Marangoni coefficient $\sigma_{T}$ & \SI{-1.622e-5}{\newton \per \metre \per \kelvin} \\

\bottomrule
\end{tabular}
\end{table}


\begin{figure}[!t]
  \centering
  \includegraphics[width=\linewidth]{Figs/LPBF_Benchmark.eps}
  \caption{Temperature field of the investigated Laser Powder Bed Fusion process. The velocity field of the melt pool is indicated by arrows. Additionally, the discretised powder bed is shown along with the computational grid.}
  \label{fig:lpbf-benchmark}
\end{figure}

\section{Summary}

In this work, we proposed a numerical solver based on the Finite Volume method that is able to incorporate various physics that are relevant for modelling non-isothermal surface flows of arbitrary many phases. We demonstrated the capabilities of the framework using one simple, two-dimensional case showing the effects of marangoni convection and subsequently with a considerably more complex and application-driven process modelling a scenario common in additive manufacturing.

We expect that the results of this work will help to improve understanding of the complex physics in metal-additive manufacturing substantially. Furthermore, the high fidelity data that can be generated using the proposed solver can be used in order to train physics informed machine learning models \cite{karniadakisPhysicsinformedMachineLearning2021}. It has previously been shown that such models can speed up simulations by order of magnitudes by execution of a simple forward pass. However, accurate and rich training data are needed in order to train such models \cite{liFourierNeuralOperator2021,luDeepONetLearningNonlinear2020}. We anticipate that this work can help supply this data and further enhance the field of modelling for complex manufacturing processes.

\section{Data Availability}\label{sec:data}

The presented solver is available via Github at \href{https://github.com/pzimbrod/thermocapillaryInterFoam}{pzimbrod/thermocapillaryInterFoam}. All data used in this article can be accessed at \href{https://github.com/pzimbrod/ieee-iceccme-2022}{pzimbrod/ieee-iceccme-2022}.

\bibliographystyle{ieeetr}
\bibliography{mybibfile}

\end{document}
